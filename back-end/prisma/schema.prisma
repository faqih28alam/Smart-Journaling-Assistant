generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Entry {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId         String       @db.Uuid
  title          String?
  rawContent     String
  tidyContent    String?
  isTidied       Boolean?     @default(false)
  mood           Mood?        @default(NEUTRAL)
  isMoodOverride Boolean?     @default(false)
  category       Category?    @default(PERSONAL)
  createdAt      DateTime?    @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime?    @default(now()) @db.Timestamptz(6)
  User           User         @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  EntryToTag     EntryToTag[]

  @@index([createdAt])
  @@index([userId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Tag {
  id         String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String       @unique
  EntryToTag EntryToTag[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model User {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email         String          @unique
  name          String?
  streakCount   Int?            @default(0)
  totalEntries  Int?            @default(0)
  createdAt     DateTime?       @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime?       @default(now()) @db.Timestamptz(6)
  Entry         Entry[]
  WeeklyInsight WeeklyInsight[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model WeeklyInsight {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String    @db.Uuid
  startDate DateTime  @db.Timestamptz(6)
  endDate   DateTime  @db.Timestamptz(6)
  summary   String
  topThemes String[]
  moodData  Json?
  createdAt DateTime? @default(now()) @db.Timestamptz(6)
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([userId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model EntryToTag {
  A     String @db.Uuid
  B     String @db.Uuid
  Entry Entry  @relation(fields: [A], references: [id], onDelete: Cascade, onUpdate: NoAction)
  Tag   Tag    @relation(fields: [B], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([A, B])
  @@map("_EntryToTag")
}

enum Category {
  WORK
  PERSONAL
  IDEAS
  GOALS
  REFLECTION
}

enum Mood {
  HAPPY
  SAD
  ANGRY
  FRUSTRATED
  ANXIOUS
  EXCITED
  CALM
  TIRED
  NEUTRAL
}
